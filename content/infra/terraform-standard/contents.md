---
layout: post
emoji: π“’
title: "ν…λΌνΌ(Terraform) κΈ°μ΄μ λ¨λ“ κ²ƒ!"
date: '2023-04-25 02:15:25'
author: μ†(Son/μ†λ―ΌκΈ°)
tags: ν…λΌνΌ μΈν”„λΌ ν΄λΌμ°λ“ AWS Azure GCP μΈν”„λΌμλ™ν™” λ¨λ“ν™” μ¬μ‚¬μ©μ„± AWSμΈν”„λΌκ΄€λ¦¬ Terraformμ½”λ“μ‘μ„± Terraformμ—°λ™ ν…μ¤νΈμλ™ν™” μ½”λ“κ²€ν†  λ³΄μ•κ΄€λ¦¬ μ»¤μ¤ν…€μ΄λ―Έμ§€ ν…λΌκ·Έλ°νΈ Atlantis ν…λΌνΌμ‹μ‘ν•κΈ° μΈν”„λΌμ¤νΈλ­μ² DevOps CI/CD Docker Kubernetes CloudFormation Packer Vault Ansible IaC InfrastructureasCode
categories: μΈν”„λΌ
---

## π“’ ν…λΌνΌ(Terraform) μ΄λ€?
> ν…λΌνΌ(Terraform)μ€ μΈν”„λΌμ¤νΈλ­μ²λ¥Ό μ½”λ“λ΅ κ΄€λ¦¬ν•κΈ° μ„ν• μ¤ν”μ†μ¤ λ„κµ¬μ…λ‹λ‹¤.
>  AWS, Google Cloud Platform, Microsoft Azure λ“± λ‹¤μ–‘ν• ν΄λΌμ°λ“ μ„λΉ„μ¤ λ° μ¨ν”„λ λ―Έμ¤ μΈν”„λΌλ¥Ό μ§€μ›ν•λ©°, μ½”λ“λ΅ μΈν”„λΌλ¥Ό κµ¬μ„±ν•κ³  λ³€κ²½μ‚¬ν•­μ„ μ¶”μ , κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

ν…λΌνΌμ„ μ‚¬μ©ν•λ” μ΄μ λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

### μ¥μ :

- μ½”λ“λ΅ μΈν”„λΌλ¥Ό κ΄€λ¦¬ν•κΈ° λ•λ¬Έμ—, λ°λ³µμ μ΄κ³  μΌκ΄€μ„± μλ” μΈν”„λΌ κµ¬μ„±μ΄ κ°€λ¥ν•©λ‹λ‹¤.
  
- μ½”λ“ κ΄€λ¦¬ λ„κµ¬(Git λ“±)λ¥Ό μ‚¬μ©ν•μ—¬ λ³€κ²½ μ΄λ ¥μ„ μ¶”μ ν•κ³ , μ΄λ ¥μ— λ”°λΌ μΈν”„λΌλ¥Ό λ³µμ›ν•  μ μμµλ‹λ‹¤.

- λ‹¤μ–‘ν• ν΄λΌμ°λ“ μ„λΉ„μ¤ λ° μ¨ν”„λ λ―Έμ¤ μΈν”„λΌλ¥Ό μ§€μ›ν•λ©°, μΈν”„λΌ λ³µμ΅λ„κ°€ λ†’μ•„μ§€λ”λΌλ„ μ½”λ“λ΅ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.
  
- ν…λΌνΌμ€ μΈν”„λΌλ¥Ό λ³€κ²½ν•  λ• μƒλ΅μ΄ μΈν”„λΌλ¥Ό λ§λ“¤κ³  μ΄μ „ μΈν”„λΌλ¥Ό μ κ±°ν•λ” λ°©μ‹μΌλ΅ λ³€κ²½μ‚¬ν•­μ„ μ μ©ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ λ³€κ²½μ‚¬ν•­ μ μ© μ¤‘μ—λ„ μΈν”„λΌμ μ•μ •μ„±μ„ μ μ§€ν•  μ μμµλ‹λ‹¤.
  
### λ‹¨μ :

- ν•™μµ κ³΅μ„ μ΄ λ†’μµλ‹λ‹¤. ν…λΌνΌμ€ λ‹¤μ–‘ν• κΈ°λ¥κ³Ό κµ¬μ„± μ”μ†λ¥Ό μ κ³µν•κΈ° λ•λ¬Έμ— μ²μ μ ‘κ·Όν•λ” μ‚¬μ©μμ—κ²λ” μ΄ν•΄ν•κΈ° μ–΄λ ¤μΈ μ μμµλ‹λ‹¤.
- ν…λΌνΌ μ½”λ“ μ‘μ„± μ‹ λ¨λ“ν™”κ°€ ν•„μ”ν• κ²½μ°κ°€ λ§μµλ‹λ‹¤.
- λ¨λ“ν™”λ μ½”λ“λ¥Ό μ‘μ„±ν•λ ¤λ©΄, μ¶”κ°€μ μΈ ν•™μµκ³Ό κ²½ν—μ΄ ν•„μ”ν•©λ‹λ‹¤.

<br/>

## β™οΈ ν…λΌνΌμ κΈ°λ³Έ νμΌ κµ¬μ„± λ° μ…ν” μ •λ¦¬

- main.tf νμΌμ—λ” μΈν”„λΌλ¥Ό κµ¬μ„±ν•λ” λ¦¬μ†μ¤μ™€ λ°μ΄ν„° μ†μ¤λ¥Ό μ •μν•©λ‹λ‹¤.
    ```lua
    provider "aws" {
        region = var.region
    }

    resource "aws_instance" "example" {
        ami           = var.ami_id
        instance_type = var.instance_type

        tags = {
            Name = "ExampleInstance"
        }
    }
    ```
- variables.tf νμΌμ—λ” μ…λ ¥ λ³€μλ¥Ό μ •μν•©λ‹λ‹¤.
    ```lua
    variable "region" {
        type        = string
        description = "AWS region to create resources in"
        default     = "us-west-2"
    }

    variable "ami_id" {
        type        = string
        description = "AMI ID for EC2 instance"
    }

    variable "instance_type" {
        type        = string
        description = "EC2 instance type"
        default     = "t2.micro"
    }
    ```

- outputs.tf νμΌμ—λ” μ¶λ ¥ λ³€μλ¥Ό μ •μν•©λ‹λ‹¤.
    ```lua
    output "public_ip" {
        value = aws_instance.example.public_ip
    }

    ```
- backend.tf ν…λΌνΌ μƒνƒ νμΌμ„ μ €μ¥ν•λ” μ„μΉμ™€ ν•μ‹μ„ μ§€μ •ν•  μ μμµλ‹λ‹¤. 
  
    ```lua
    # S3 λ²„ν‚·μ— μƒνƒλ¥Ό μ €μ¥ν•λ”λ° μ‚¬μ©ν•©λ‹λ‹¤. 
    # λ™μ‹μ„± μ²΄ν¬ λ° μ΄λ―Έ λ§λ“¤μ–΄μ Έ μ—°κ΄€ μλ” κµ¬μ΅°λ¥Ό κ°–κ³ μ¬ λ–„ μ‚¬μ©ν•©λ‹λ‹¤.
    terraform {
     backend "s3" {
            bucket = "my-terraform-state"
            key    = "terraform.tfstate"
            region = "us-west-2"
        }
    }
  ```
- env.tfvars νμΌμ—μ„λ” ν™κ²½ λ³€μλ¥Ό μ •μν•©λ‹λ‹¤. ν™κ²½ λ³€μλ” ν…λΌνΌ μ‹¤ν–‰ μ‹ -var-file μµμ…μ„ μ‚¬μ©ν•μ—¬ μ§€μ •ν•  μ μμµλ‹λ‹¤.
    ```lua
    region          = "us-west-2"
    ami_id          = "ami-0c55b159cbfafe1f0"
    instance_type   = "t2.micro"
    ```

<br/>

## β™οΈ κµ¬μ„± λ¬Έλ²•μ€ μ•„λμ™€ κ°™μµλ‹λ‹¤.

- data : λ¦¬μ†μ¤κ°€ μ•„λ‹ λ°μ΄ν„° μ†μ¤(Data Source)λ¥Ό μ •μν•λ” λ…λ Ήμ–΄μ…λ‹λ‹¤.

- module : λ¨λ“(Module)μ„ μ •μν•λ” λ…λ Ήμ–΄μ…λ‹λ‹¤. λ¨λ“μ€ μ¬μ‚¬μ© κ°€λ¥ν• μ½”λ“ λΈ”λ΅μΌλ΅, ν…λΌνΌ μ½”λ“λ¥Ό λ”μ± λ¨λ“ν™”ν•μ—¬ μ½”λ“μ κ°€λ…μ„±κ³Ό μ μ§€λ³΄μμ„±μ„ λ†’μΌ μ μμµλ‹λ‹¤.
    ```lua
    module "vpc" {
        # source μ„ μ–Έλ λ””λ ‰ν† λ¦¬ λ©”μΈ μ½”λ“μ νΈμ¶ν•λ”λ° μ‚¬μ©λ©λ‹λ‹¤.
        source = "terraform-aws-modules/vpc/aws"

        name                 = "example-vpc"
        cidr                 = "10.0.0.0/16"
        azs                  = ["us-west-2a", "us-west-2b"]
        public_subnets       = ["10.0.1.0/24", "10.0.2.0/24"]
        private_subnets      = ["10.0.10.0/24", "10.0.20.0/24"]
        enable_nat_gateway   = true
        single_nat_gateway   = true
        enable_dns_hostnames = true
    }
    ```
- provider : μ‚¬μ©ν•  ν΄λΌμ°λ“ μ„λΉ„μ¤ κ³µκΈ‰μ(Provider)λ¥Ό μ •μν•λ” λ…λ Ήμ–΄μ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, AWSλ¥Ό μ‚¬μ©ν•λ” κ²½μ° provider "aws" {}μ™€ κ°™μ΄ μ‘μ„±ν•©λ‹λ‹¤.
    
    ```lua
    provider "aws" {
        region = "us-west-2"
    }

    resource "aws_instance" "example" {
        ami           = "ami-0c55b159cbfafe1f0"
        instance_type = "t2.micro"
    }
    ```
  
- variable : μ…λ ¥ λ³€μ(Variable)λ¥Ό μ •μν•λ” λ…λ Ήμ–΄μ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, νΉμ • AMI IDλ¥Ό λ³€μλ΅ μ§€μ •ν•μ—¬ EC2 μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•λ” κ²½μ° variable "ami_id" {}μ™€ κ°™μ΄ μ‘μ„±ν•©λ‹λ‹¤.

    ```lua
    variable "ami_id" {
        type        = string
        description = "AMI ID for EC2 instance"
    }

    resource "aws_instance" "example" {
        ami           = var.ami_id
        instance_type = "t2.micro"
    }
    ```

  
- output : μ¶λ ¥ λ³€μ(Output)λ¥Ό μ •μν•λ” λ…λ Ήμ–΄μ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, EC2 μΈμ¤ν„΄μ¤μ IP μ£Όμ†λ¥Ό μ¶λ ¥ν•λ” κ²½μ° output "instance_ip" {}μ™€ κ°™μ΄ μ‘μ„±ν•©λ‹λ‹¤.
  
    ```lua
    resource "aws_instance" "example" {
        ami           = "ami-0c55b159cbfafe1f0"
        instance_type = "t2.micro"

        provisioner "local-exec" {
            command = "echo ${self.public_ip} > ip_address.txt"
        }
    }

    output "instance_ip" {
        value = aws_instance.example.public_ip
    }
    ```

## π”— μ—¬λ¬κ°€μ§€μ μ•„ν‚¤ν…μ² μ •λ¦¬

### μ΄μ• 1

    β”β”€β”€ main.tf
    β”β”€β”€ variables.tf
    β”β”€β”€ outputs.tf
    β”β”€β”€ backend.tf
    β”β”€β”€ env.tfvars
    β”β”€β”€ modules
    β”‚   β”β”€β”€ vpc
    β”‚   β”‚   β”β”€β”€ main.tf
    β”‚   β”‚   β”β”€β”€ variables.tf
    β”‚   β”‚   β”β”€β”€ outputs.tf
    β”‚   β”‚   β””β”€β”€ README.md
    β”‚   β”β”€β”€ ec2
    β”‚   β”‚   β”β”€β”€ main.tf
    β”‚   β”‚   β”β”€β”€ variables.tf
    β”‚   β”‚   β”β”€β”€ outputs.tf
    β”‚   β”‚   β””β”€β”€ README.md
    β”‚   β””β”€β”€ ...
    β”β”€β”€ data
    β”‚   β”β”€β”€ example.tf
    β”‚   β””β”€β”€ ...
    β””β”€β”€ README.md

### μ΄μ• 2

    β”β”€β”€ infra
    β”‚Β Β  β”β”€β”€ rds
    β”‚Β Β  β”‚Β Β  β”β”€β”€ mariana_db
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β”β”€β”€ README.md
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β”β”€β”€ backend.tf
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β”β”€β”€ env-dev.tfvars
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β”β”€β”€ env-staging.tfvars
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β”β”€β”€ terraform.tf
    β”‚Β Β  β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
    β”‚Β Β  β””β”€β”€ vpc
    β”‚Β Β      β”β”€β”€ README.md
    β”‚Β Β      β”β”€β”€ backend.tf
    β”‚Β Β      β”β”€β”€ env-dev.tfvars
    β”‚Β Β      β”β”€β”€ env-staging.tfvars
    β”‚Β Β      β”β”€β”€ main.tf
    β”‚Β Β      β”β”€β”€ terraform.tf
    β”‚Β Β      β””β”€β”€ variables.tf
    β”β”€β”€ modules
    β”‚Β Β  β”β”€β”€ ec2
    β”‚Β Β  β”‚Β Β  β”β”€β”€ ec2.tf
    β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
    β”‚Β Β  β”‚Β Β  β”β”€β”€ output.tf
    β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
    β”‚Β Β  β”β”€β”€ loadbalancer
    β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
    β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
    β”‚   β””β”€β”€ ...
    β””β”€β”€ service
        β”β”€β”€ backend_example
        β”‚Β Β  β”β”€β”€ README.md
        β”‚Β Β  β”β”€β”€ alb.tf
        β”‚Β Β  β”β”€β”€ ec2.tf
        β”‚Β Β  β”β”€β”€ provider.tf
        β”‚Β Β  β”β”€β”€ script.sh
        β”‚Β Β  β”β”€β”€ terraform.tfvars
        β”‚Β Β  β””β”€β”€ variables.tf
        β”β”€β”€ frontend_example
        β”‚    β”β”€β”€ README.md
        β”‚    β”β”€β”€ backend.tf
        β”‚    β”β”€β”€ env-dev.tfvars
        β”‚    β”β”€β”€ env-prod.tfvars
        β”‚    β”β”€β”€ env-stage.tfvars
        β”‚    β”β”€β”€ main.tf
        β”‚    β”β”€β”€ terraform.tf
        β”‚    β””β”€β”€ variables.tf
        β”‚
        β””β”€β”€ ...

## β’οΈ ν…λΌνΌ μ‹¤ν–‰ λ…λ Ήμ–΄λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

```sh
terraform init      # λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ ν…λΌνΌ μ„¤μ •μ„ μ΄κΈ°ν™”ν•©λ‹λ‹¤.
terraform plan      # λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ μΈν”„λΌ λ³€κ²½μ‚¬ν•­μ„ κ²€ν† ν•©λ‹λ‹¤.
terraform apply     # λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ μΈν”„λΌ λ³€κ²½μ‚¬ν•­μ„ μ μ©ν•©λ‹λ‹¤.
terraform destroy   # λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ μΈν”„λΌλ¥Ό μ κ±°ν•©λ‹λ‹¤.
```

## π’™ μ†κ°

- μ΄μƒμΌλ΅ ν…λΌνΌ(Terraform)μ— λ€ν• κΈ°λ³Έμ μΈ λ‚΄μ©κ³Ό ν…λΌνΌ μ½”λ“μ κµ¬μ΅°, λ…λ Ήμ–΄ λ“±μ— λ€ν•΄ μ•μ•„λ³΄μ•μµλ‹λ‹¤. 

- ν…λΌνΌμ€ ν΄λΌμ°λ“ μΈν”„λΌλ¥Ό μ½”λ“λ΅ κ΄€λ¦¬ν•κ³ , μλ™ν™”λ μΈν”„λΌ λ°°ν¬λ¥Ό κ°€λ¥μΌ€ ν•΄μ£Όλ” κ°•λ ¥ν• λ„κµ¬μ…λ‹λ‹¤.


### λ§μ§€λ§‰μΌλ΅ ν…λΌνΌκ³Ό κ°™μ΄ μ“°λ©΄ μΆ‹μ€κ²ƒλ“¤ !


- Packer: μΈν”„λΌλ¥Ό μ„ν• μ»¤μ¤ν…€ μ΄λ―Έμ§€λ¥Ό λ§λ“¤κΈ° μ„ν• λ„κµ¬μ…λ‹λ‹¤. Packerλ¥Ό μ‚¬μ©ν•λ©΄ μΈν”„λΌ λ¦¬μ†μ¤λ¥Ό λ―Έλ¦¬ μ„¤μΉν•κ³  κµ¬μ„±ν•μ—¬ μ»¤μ¤ν…€ μ΄λ―Έμ§€λ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

- Vault: λ³΄μ• κ΄€λ¦¬ λ„κµ¬λ΅, ν…λΌνΌμ—μ„ μ‚¬μ©λλ” λΉ„λ°€ μ •λ³΄λ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•  μ μλ„λ΅ λ„μ™€μ¤λ‹λ‹¤.

- Atlantis: ν…λΌνΌ μ½”λ“μ λ³€κ²½ μ‚¬ν•­μ„ λ²„μ „ κ΄€λ¦¬ μ‹μ¤ν…κ³Ό μ—°λ™ν•μ—¬ μλ™ν™”λ μ½”λ“ κ²€ν† λ¥Ό μ κ³µν•λ” λ„κµ¬μ…λ‹λ‹¤.

- Terratest: ν…λΌνΌ μ½”λ“μ λ‹¨μ„ ν…μ¤νΈλ¥Ό μ„ν• λ„κµ¬λ΅, ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•μ—¬ ν…λΌνΌ μ½”λ“ λ³€κ²½ μ‚¬ν•­μ΄ ν”„λ΅λ•μ…μ— μν–¥μ„ λ―ΈμΉμ§€ μ•λ„λ΅ λ³΄μ¥ν•©λ‹λ‹¤.

μ΄ μ™Έμ—λ„ λ‹¤μ–‘ν• ν…λΌνΌκ³Ό κ΄€λ ¨λ λ„κµ¬λ“¤μ΄ μμµλ‹λ‹¤. μ΄λ“¤ λ„κµ¬λ“¤μ„ ν™μ©ν•λ©΄ ν…λΌνΌμ„ λ”μ± ν¨μ¨μ μΌλ΅ μ‚¬μ©ν•  μ μμΌλ©°, μ½”λ“μ κ°€λ…μ„±κ³Ό μ μ§€λ³΄μμ„±μ„ λ†’μΌ μ μμµλ‹λ‹¤.


κ°μ‚¬ν•©λ‹λ‹¤!


```toc

```